<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.cloud_storage.DAO.File_DAO">


    <select id="selectFileById" parameterType="int" resultType="com.cloud_storage.entity.File">
        select * from file where file_id = #{file_id}
    </select>

    <!-- 为了返回list 类型而定义的returnMap -->
    <resultMap type="com.cloud_storage.entity.File" id="resultListFile">
        <id column="file_id" property="file_id" />
        <result column="filename" property="filename" />
        <result column="user_id" property="user_id" />
    </resultMap>
    <!-- 返回list 的select 语句，注意 resultMap 的值是指向前面定义好的 -->
    <select id="selectAllFilesByUser" parameterType="com.cloud_storage.entity.User" resultMap="resultListFile">
        select * from file where user_id = #{user_id}
    </select>
    <select id="selectPublicFilesByUser" parameterType="com.cloud_storage.entity.User" resultMap="resultListFile">
        select * from file where user_id = #{user_id} and authority = 1
    </select>


    <insert id="insert_file_share"
            useGeneratedKeys="true" keyProperty="id" >
        insert into file_share(user_id,target_id,file_id,is_valid,date)
        values(#{user_id},#{target_id},#{file_id},#{is_valid},#{date})
    </insert>


    <resultMap type="com.cloud_storage.entity.File_share" id="resultListFileShare">
        <id column="user_id" property="user_id" />
        <result column="file_id" property="file_id" />
        <result column="date" property="date" />
    </resultMap>
    <select id="select_file_share" parameterType="int" resultMap="resultListFileShare">
        select * from file_share where target_id = #{target_id} and is_valid = 1
    </select>


    <update id="update_share_states_to_0" >
        update file_share set is_valid= 0 where target_id=#{target_id} and file_id=#{file_id} and is_valid=#{is_valid} and date=#{date}
    </update>

    <insert id="insert_file"
            useGeneratedKeys="true" keyProperty="id" >
        insert into file(filename,user_id,file_path,authority)
        values(#{filename},#{user_id},#{file_path},#{authority})
    </insert>

    <update id="update_file_auth" >
        update file set authority= #{Auth} where file_id=#{File_id}
    </update>

    <update id="update_file_name" >
        update file set filename= #{New_name} where file_id=#{File_id}
    </update>

    <delete id="delete_file" parameterType="int">
        delete from file where file_id=#{file_id}
    </delete>



</mapper>